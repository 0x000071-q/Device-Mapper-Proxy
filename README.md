# Device-Mapper-Proxy (DMP) — Руководство пользователя

>  **Важно:** для выполнения большинства команд требуются права администратора (sudo). Убедитесь, что у вас есть соответствующие привилегии.

## Сборка, установка и переустановка модуля

Для сборки и установки модуля выполните следующую команду:

```bash
./dmp_control.sh i
```

Скрипт автоматически выполнит следующие действия:

1. Очистит предыдущую сборку (`make clean`).
2. Соберёт модуль (`make`).
3. Удалит старые версии устройств и модуля, если они уже загружены:
   - Удаление `dmp1`
   - Удаление `zero1`
   - Удаление модуля `dmp`
4. Установит собранный модуль:
   ```bash
   sudo insmod dmp.ko
   ```
5. Создаст устройства:
   ```bash
   sudo dmsetup create zero1 --table "0 4096 zero"
   sudo dmsetup create dmp1 --table "0 4096 dmp /dev/mapper/zero1"
   ```

---

## Тестирование

Для тестирования модуля доступны два флага: `w` (запись) и `r` (чтение).

### Тест записи

Выполните команду:

```bash
./dmp_control.sh w
```

Она выполнит следующие шаги:

1. Выведет статистику до записи:
   ```bash
   cat /sys/module/dmp/stat/volumes
   ```
2. Выполнит запись:
   ```bash
   sudo dd if=/dev/random of=/dev/mapper/dmp1 bs=4k count=1
   ```
3. Выведет статистику после записи.

---

### Тест чтения

Выполните команду:

```bash
./dmp_control.sh r
```

Она выполнит следующие шаги:

1. Выведет статистику до чтения:
   ```bash
   cat /sys/module/dmp/stat/volumes
   ```
2. Выполнит чтение:
   ```bash
   sudo dd of=/dev/null if=/dev/mapper/dmp1 bs=4k count=1
   ```
3. Выведет статистику после чтения.

---

## Очистка

Для удаления скомпилированных артефактов выполните:

```bash
./dmp_control.sh clean
```

Очистит результаты сборки в каталоге `src`.

---

